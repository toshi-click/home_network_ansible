---
# ciscoL2機器の処理を行う
- hosts:
    - l2
  gather_facts: no
  tasks:
    - name: setting vlan interface vlan1
      ios_config:
        lines:
          - 'ip address 172.28.1.2 255.255.255.0'
        parents: interface Vlan1

    - name: Configure interfaces - Status and Descriptions
      ios_interfaces:
        config:
          - name: "{{ item.ios_if }}"
            description: "{{ item.desc }}"
            enabled: "{{ item.enabled }}"
      loop: "{{ interfaces }}"

    - name: Configure interfaces - L2 switchport
      cisco.ios.ios_l2_interfaces:
        config:
          - name: "{{ item.ios_if }}"
            mode:  "{{ item.mode }}"
            access:
              vlan: "{{ item.vlan_id }}"
        state: merged
      when: item.mode == "access"
      loop: "{{ interfaces }}"

    - name: Merge provided configuration with device configuration
      cisco.ios.ios_l2_interfaces:
        config:
          - name: GigabitEthernet0/9
            mode: trunk
            trunk:
              allowed_vlans: 1,77,177
              native_vlan: 1
              encapsulation: dot1q
        state: merged
